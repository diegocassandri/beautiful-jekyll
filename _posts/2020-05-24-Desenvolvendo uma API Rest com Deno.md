---
layout: post
title: Desenvolvendo uma API Rest com Deno
subtitle: Desenvolvendo uma API Rest com Deno
bigimg:
    - "/img/Deno.jpeg" : ""
---

# Desenvolvendo uma API Rest com Deno

![Deno](/img/Deno.jpeg)

Recentemente o Deno na sua versÃ£o 1.0 Beta foi lanÃ§ado. Mas de fato o que seria o Deno? Ele vai substituir o Node? O que esperar para o futuro?

Vamos entender nesse artigo qual Ã© o objetivo base do Deno e quais sÃ£o os problemas que o mesmo se propÃµe a resolver.

ApÃ³s isso vamos desenvolver junto uma simples API Rest utilizando o Deno.

Assim vocÃª entenderÃ¡ quais sÃ£o os objetivos do Deno e se deve utiliza-lo em seus projetos no futuro.

## O que Ã© o Deno?

Deno Ã© um Runtime Javascript como o NodeJs e foi criado em conjunto com um dos mesmos criadores do NodeJs **Ryan Daahl**.  O Deno vem entÃ£o para resolver alguns problemas que o Node possui na visÃ£o do prÃ³prio Ryan.

O Slogan do Deno Ã© " A secure runtime for javaScript and TypeScript". Dai nÃ³s jÃ¡ podemos tirar algumas conclusÃµes de qual Ã© o principal propÃ³sito do Deno. Que de fato Ã© ser um ambiente de execuÃ§Ã£o javaScript e TapeScript seguro por padrÃ£o.

Essa questÃ£o da seguranÃ§a vem principalmente pela linguagem que o Deno foi construÃ­do que Ã© o Rust. Uma linguagem de programaÃ§Ã£o com com mesmo propÃ³sito, construir aplicaÃ§Ãµes seguras por padrÃ£o.

## Principais recursos do Deno

- O Deno suporta TypeScript sem a necessidade de transpilaÃ§Ã£o manual. Ou Seja o Deno faz isso de forma automÃ¡tica para gente.
- Sem node_modules. O Deno nÃ£o usa o NPM para a instalaÃ§Ã£o de pacotes. Ao invÃ©s disso ele importa as bibliotecas de servidores externos diretamente de sua URL. EX:  import {server} from '[https://deno.land/std@0.50.5/http/server.ts](https://deno.land/std@0.50.5/http/server.ts)'
- JÃ¡ possui nativamente os recursos mais recentes do ECMAScript. Algo que no Node existe um tempo maior para liberaÃ§Ã£o desses recursos.
- Ã‰ essencialmente um loop for que permite percorrer um array infinito, vocÃª pode dizer um array infinito de dados e eventos recebidos.

![API%20REST%20com%20Deno%204d3e5bdb1b304b71af7c1a4a2c590116/1_jQQC7ySp-thNY3cHrSRgYQ.png](/img/1_jQQC7ySp-thNY3cHrSRgYQ.png)

- Para maiores informaÃ§Ãµes a respeito do Deno e seus recursos vale dar uma olhadinha no BLOG do projeto.

> [https://deno.land/v1](https://deno.land/v1)

### O Deno vai substituir o Node?

Tenha em mente que o NodeJs Ã© largamente utilizado por grandes empresas atualmente. Muitos projetos e bibliotecas sÃ£o desenvolvidos no contexto do NodeJS, uma serie de frameworks Frontend inclusive utilizam do Node em tempo de desenvolvimento. Dessa forma nÃ£o podemos considerar que o Node Ã© apenas um Runtime JavaScript, hoje ele Ã© muito mais que isso.

O Deno surge como uma alternativa ao node, porÃ©m ainda muito imaturo, com alguns bugs. Ainda nÃ£o sabemos o que o time de desenvolvimento do Deno vai tomar de decisÃµes para o futuro.

Atualmente o Deno ainda nÃ£o possui suporte para Pacotes Node e nem sabemos ainda se isso vai ser possÃ­vel.

Sendo assim o Deno Ã© uma tecnologia muito recente para dizermos com certeza como o mesmo vai evoluir e como o mercado vai reagir.

PorÃ©m vale sempre acompanhar a evoluÃ§Ã£o da tecnologia e sinceramente um Runtime TypeScript nativo Ã© algo que definitivamente deve ser olhado com carinho.

## Construindo nossa primeira API com DENO

Agora que entendemos um pouco do Deno chegou a hora de colocarmos a mÃ£o na massa para construir nossa primeira API Rest.

### Nossos objetivos

- InstalaÃ§Ã£o do Deno
- Criar uma API para manutenÃ§Ã£o de produtos
- Prover rotar de GET,POST,PUT e DELETE
- Salvar criar/atualizar produtos em um arquivo JSON local

### InstalaÃ§Ã£o

Vou mostrar aqui duas formas de instalaÃ§Ã£o Mac/Linux e Windows. PorÃ©m no link a seguir vocÃª pode consultor a instalaÃ§Ã£o para outros sistemas operacionais. 

> [https://deno.land/#installation](https://deno.land/#installation)

Shell (Mac, Linux):

```bash
curl -fsSL https://deno.land/x/install/install.sh | sh
```

PowerShell (Windows):

```powershell
iwr https://deno.land/x/install/install.ps1 -useb | iex
```

Para verificar se o Deno foi instalado bem como sua versÃ£o utilizar o comando *deno --version*

```powershell
deno --version
deno 1.0.0
v8 8.4.300
typescript 3.9.2
```

### Executando uma aplicaÃ§Ã£o Deno

Executando o comando deno run [https://deno.land/std/examples/welcome.ts](https://deno.land/std/examples/welcome.ts). o mesmo serÃ¡ baixado e compilado. Esse exemplo te ajudarÃ¡ a tentar o ambiente do Deno em sua mÃ¡quina.

```powershell
deno run https://deno.land/std/examples/welcome.ts
Download https://deno.land/std/examples/welcome.ts
Warning Implicitly using master branch https://deno.land/std/examples/welcome.ts
Compile https://deno.land/std/examples/welcome.ts
Welcome to Deno ðŸ¦•
```

Se vocÃª executar o comando novamente vai perceber que o cÃ³digo nÃ£o serÃ¡ baixado novamente, o Deno vai usar o cÃ³digo jÃ¡ baixado da sua Ã¡rea de cache.

### Lista de parÃ¢metros de permissÃ£o

Como o Deno Ã© seguro por padrÃ£o as aplicaÃ§Ãµes criadas nÃ£o possuir qualquer permissÃ£o de acesso a recursos. Para isso Ã© preciso dizer explicitamente o que a aplicaÃ§Ã£o tem permissÃ£o no momento da execuÃ§Ã£o da mesma. Isso Ã© feito atravÃ©s da passagem de parÃ¢metros para a aplicaÃ§Ã£o:

- **`â€” allow-env:`**Â Allow environment access. (Acesso ao ambiente)
- **`â€” allow-hrtime:`**Â Allow high-resolution time measurement.
- **`â€” allow-net:`**Â Allow network access. (Acesso a recrusos de rede)
- **`â€” allow-plugin:`**Â Allow loading plugins.
- **`â€” allow-read:`**Â Allow file system read access. (Acesso de leitura ao sistema de arquivos)
- **`â€” allow-run:`**Â Allow running subprocesses.
- **`â€” allow-write:`**Â Allow file system write access. (Acesso de escrita ao sistema de arquivos)
- **`â€” allow-all:`:**Â Give all access. (Permitir Tudo)

### Iniciando

NÃ³s vamos desenvolver uma simples API Rest usando TypeScript e o framework oak para trabalhar com requisiÃ§Ãµes http. A API vai fornecer rotas par a operaÃ§Ãµes de CRUD de produtos. Para testar os endpoints vamos utilizar o Postman.

Se vocÃª estÃ¡ usando o Visual Studio Code Ã© recomendado que use o Plugin para trabalhar com o Deno. Caso contrÃ¡rio terÃ¡ erros de importaÃ§Ã£o das dependÃªncias. Deno Plugin [deno](https://marketplace.visualstudio.com/items?itemName=justjavac.vscode-deno).

> Passo 1 : Estrutura do Projeto

![API%20REST%20com%20Deno%204d3e5bdb1b304b71af7c1a4a2c590116/Untitled.png](/img/Untitled.png)

- **Controllers:**Â Tem a lÃ³gica da aplicaÃ§Ã£o e trabalha com as requisiÃ§Ãµes recebidas.
- **Routes.ts:**Â contÃ©m as rotas da aplicaÃ§Ã£o.
- **Server.ts:**Â codigo para rodar o servidor.
- **Types.ts:**Â contÃ©m nossa definiÃ§Ã£o de modelos.

> Passo 2: A escolha de um framework Web

Como no Node nÃ³s temo o Express no Deno nÃ³s temos o Oak que foi lanÃ§ado em sua primeira versÃ£o juntamente com o Deno.

> Passo 3: Subindo um servidor Local.

crie o arquivo `server.ts`Â e importe:  

```tsx
import { Application } from 'https://deno.land/x/oak/mod.ts'
const port = 8000

console.log(`Server running on port ${port}`)
```

> Passo 4: Criando as rotas

Agora vamos cruar o arquivo `routes.ts`e importar: 

```tsx
import { Router } from 'https://deno.land/x/oak/mod.ts'
import { getProducts, getProduct, addProduct, updateProduct, deleteProduct } from './controllers/products.ts'

const router = new Router()

router.get('/api/v1/products', getProducts)
    .get('/api/v1/products/:id', getProduct)
    .post('/api/v1/products', addProduct)
    .put('/api/v1/products/:id', updateProduct)
    .delete('/api/v1/products/:id', deleteProduct)

export default router
```

NÃ£o se confundir com os mÃ©todos das rotas. NÃ³s vamos cria-los a seguir no nosso controller.

Agora, voltando no nosso arquivo `server.ts`, importe nossoa rquivo de rotas, e crie uma isntancia da aplicaÃ§Ã£o que vai ouvir na porta definida. A vesÃ£o final do `server.ts` ficarÃ¡ assim:

```tsx
import { Application } from 'https://deno.land/x/oak/mod.ts'
import router from './routes.ts'
const port = 8000

const app = new Application()

app.use(router.routes())
app.use(router.allowedMethods())

console.log(`Server running on port ${port}`)

await app.listen({ port })
```

> Passo 5: Criando nosso model

`types.ts`Â serÃ¡ uma interface que representa nossa entidade produto.

```tsx
export interface Product {
    id: string;
    name: string;
    description: string;
    price: number;
}
```

> Passo 6: Criando nosso Controller

Vamos criar um array de produtos inicial para comeÃ§ar.

```tsx
import { v4 } from 'https://deno.land/std/uuid/mod.ts'
import { Product } from '../types.ts'

let products: Product[] = [
    {
      id: "1",
      name: "Product One",
      description: "This is product one",
      price: 99.99,
    },
    {
      id: "2",
      name: "Product Two",
      description: "This is product two",
      price: 150.99,
    },
    {
      id: "3",
      name: "Product Three",
      description: "This is product three",
      price: 199.99,
    },
  ];
```

Agora vamos criar diferentes mÃ©todos no nosso controller `products.ts` e testar no Postman.

**getProducts:** Vai retornar todos os produtos da lista. Fazendo uma requisiÃ§Ã£o GET  paraÂ `/api/v1/producs`

```tsx
const getProducts = ({ response }: { response: any }) => {
    response.body = {
        success: true,
        data: products
    }
}
```

> Testando no Postman

![GETPRODUCTS](/img/APIDENO/GET.png)

**getProduct:**Â Vai retornar um Ãºnico produto pelo seu Id e um erro se o produto nÃ£o for encontrado. Fazendo uma requisiÃ§Ã£o GET para `/api/v1/products/:id`

```tsx
const getProduct = ({ params, response }: { params: { id: string }, response: any }) => {
    const product: Product | undefined = products.find(p => p.id === params.id)

    if (product) {
        response.status = 200
        response.body = {
            success: true,
            data: product
        }
    } else {
        response.status = 404
        response.body = {
            success: false,
            msg: 'No product found'
        }
    }
}
```

> Testando no Postman

![GETONEPRODUCT](/img/APIDENO/GETONE.png)

Produto nÃ£o encontrado

![GETNOTPRODUCT](/img/APIDENO/GETNOT.png)

Error: Produto nÃ£o encontrado

**addProduct:**Â Vai adicionar um novo produto na lista. Fazendo uma requisiÃ§Ã£o POST paraÂ `/api/v1/products.`

```tsx
const addProduct = async ({ request, response }: { request: any, response: any }) => {    
    const body = await request.body()

    if (!request.hasBody) {
        response.status = 400
        response.body = {
            success: false,
            msg: 'No data'
        }
    } else {
        const product: Product = body.value
        product.id = v4.generate()
        products.push(product)
        response.status = 201
        response.body = {
            success: true,
            data: product
        }
    }
}
```

> Testando no Postman

![POST](/img/APIDENO/POST.png)

![POSTRESPONSE](/img/APIDENO/POSTRESPONSE.png)

**updateProduct:**Â Vai atualizar um produto. Fazendo uma requisiÃ§Ã£o PUT para`/api/v1/products/:id.`

```tsx
const updateProduct = async({ params, request, response }: { params: { id: string }, request: any, response: any }) => {
    const product: Product | undefined = products.find(p => p.id === params.id)

    if (product) {
        const body = await request.body()

        const updateData: { name?: string; description?: string; price?: number } = body.value

        products = products.map(p => p.id === params.id ? { ...p, ...updateData } : p)

        response.status = 200
        response.body = {
            success: true,
            data: products
        }
    } else {
        response.status = 404
        response.body = {
            success: false,
            msg: 'No product found'
        }
    }
}
```

> Testando no Postman


![PUT](/img/APIDENO/PUT.png)

Dados para atualizar o nome do Produto

![PUTRESPONSE](/img/APIDENO/PUTRESPONSE.png)

Nome do produto Id: 2 atualizado.

**deleteProduct:**Â Vai deletar um produto da lista. Fazendo uma requisiÃ§Ã£o DELETE paraÂ `/api/v1/product/:id`

```tsx
const deleteProduct = ({ params, response }: { params: { id: string }, response: any }) => {
    products = products.filter(p => p.id !== params.id)
    response.body = { 
        success: true,
        msg: 'Product removed'
    }
}
```

> Testando no Postman

![DELETE](/img/APIDENO/DELETE.png)

ApÃ³s criado nosso mÃ©todos, nÃ³s precisamos importa-lÃ³s no nosso arquivo de rotas. Exportando os mesmos do nosso arquivo `product.ts`

```tsx
export { getProducts, getProduct, addProduct, updateProduct, deleteProduct }

```

## ConclusÃ£o

Chegamos ao final do nosso guia, passamos pela introduÃ§Ã£o do Deno, instalaÃ§Ã£o e desenvolvemos uma API simples usando o Deno. Caso queria saber mais recomendo dar uma olhada na documentaÃ§Ã£o oficial Â [documentaÃ§Ã£o](https://deno.land/manual).  Deno possui uma lisa incrÃ­vel de bibliotecas padrÃµesÂ [Standard Library](https://deno.land/std)Â eÂ [Third-Party Modules.](https://deno.land/x)

O cÃ³digo completo do guia pode ser encontrado no meu GitHub:  

[diegocassandri/deno-api-example](https://github.com/diegocassandri/deno-api-example)

Esse artigo foi baseado em dois artigos que cito referÃªncias abaixo:

[Let's meet Deno the Dinosaur ðŸ¦•](https://medium.com/@pushkar.thakur28/lets-meet-dino-the-dinosaur-2b406ad0db1c)

[Pushkar Thakur - Medium](https://medium.com/@pushkar.thakur28)